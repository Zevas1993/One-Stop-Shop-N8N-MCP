{
  "name": "AI Email Manager - Teams & Outlook Integration",
  "nodes": [
    {
      "parameters": {
        "path": "email-webhook",
        "responseMode": "onReceived",
        "responseData": "allData"
      },
      "id": "webhook-teams-trigger",
      "name": "Webhook - Teams Chat",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [100, 300],
      "webhookId": "teams-email-trigger"
    },
    {
      "parameters": {
        "operation": "getMessages",
        "channelId": "{{ $json.channelId }}",
        "limit": 10
      },
      "id": "get-teams-messages",
      "name": "Get Teams Messages",
      "type": "n8n-nodes-base.microsoftTeams",
      "typeVersion": 1,
      "position": [300, 200],
      "credentials": {
        "microsoftTeamsOAuth2Api": "teams-credential"
      }
    },
    {
      "parameters": {
        "operation": "getEmails",
        "mailbox": "{{ $json.userEmail }}",
        "limit": 50,
        "filters": {
          "unread": false,
          "from": "",
          "subject": ""
        }
      },
      "id": "get-outlook-emails",
      "name": "Get Outlook Emails",
      "type": "n8n-nodes-base.microsoftOutlook",
      "typeVersion": 2,
      "position": [300, 450],
      "credentials": {
        "microsoftOutlookOAuth2Api": "outlook-credential"
      }
    },
    {
      "parameters": {
        "operation": "getAttachments",
        "messageId": "{{ $json.messageId }}"
      },
      "id": "get-email-history",
      "name": "Get Historical Emails",
      "type": "n8n-nodes-base.microsoftOutlook",
      "typeVersion": 2,
      "position": [300, 600],
      "credentials": {
        "microsoftOutlookOAuth2Api": "outlook-credential"
      }
    },
    {
      "parameters": {
        "sessionId": "email-analysis",
        "systemPrompt": "You are an intelligent email management assistant. Your responsibilities are:\n\n1. EMAIL ORGANIZATION & CATEGORIZATION:\n   - Analyze received emails and organize them by priority (urgent, important, routine, informational)\n   - Categorize emails by topic/department (sales, support, internal, etc.)\n   - Flag emails that require immediate action or escalation\n\n2. EMAIL ANALYSIS & SUMMARIZATION:\n   - Provide concise summaries of email threads\n   - Extract key action items and deadlines\n   - Identify sentiment and tone of communication\n\n3. RESPONSE DRAFTING:\n   - Draft professional email responses that match the user's communication style\n   - Use historical sent emails to understand tone, vocabulary, and signature preferences\n   - Suggest responses that address all points in the original email\n   - Provide alternatives when appropriate (formal, casual, urgent tones)\n\n4. EMAIL DATA QUERIES:\n   - Search and retrieve emails matching specific criteria\n   - Analyze email patterns (frequency, typical responders, time of day)\n   - Provide insights about communication volumes and trends\n\n5. WORKFLOW EXECUTION:\n   - For each incoming Teams message about emails, determine the required action\n   - Execute the appropriate email operations\n   - Report results back to Teams channel\n\nAlways be professional, accurate, and proactive in managing email communications.",
        "tools": [
          {
            "name": "analyze_email_content",
            "description": "Analyze email content for organization, priority, and categorization"
          },
          {
            "name": "summarize_thread",
            "description": "Summarize an email thread or conversation"
          },
          {
            "name": "draft_response",
            "description": "Draft an email response matching user's tone and style"
          },
          {
            "name": "search_emails",
            "description": "Search inbox for emails matching criteria"
          },
          {
            "name": "get_email_stats",
            "description": "Analyze email statistics and patterns"
          }
        ],
        "model": "gpt-4",
        "temperature": 0.7,
        "maxTokens": 2000
      },
      "id": "agent-cluster-email-manager",
      "name": "Agent Cluster - Email Manager",
      "type": "n8n-nodes-base.agentCluster",
      "typeVersion": 1,
      "position": [550, 350],
      "credentials": {
        "openAiApi": "openai-credential"
      }
    },
    {
      "parameters": {
        "operation": "sendMessage",
        "channelId": "{{ $json.channelId }}",
        "messageContent": "{{ $json.agentResponse }}"
      },
      "id": "send-teams-response",
      "name": "Send Teams Response",
      "type": "n8n-nodes-base.microsoftTeams",
      "typeVersion": 1,
      "position": [800, 200],
      "credentials": {
        "microsoftTeamsOAuth2Api": "teams-credential"
      }
    },
    {
      "parameters": {
        "operation": "sendEmail",
        "to": "{{ $json.replyTo }}",
        "subject": "Re: {{ $json.originalSubject }}",
        "body": "{{ $json.draftedResponse }}",
        "importance": "{{ $json.priority }}"
      },
      "id": "send-email-reply",
      "name": "Send Email Reply",
      "type": "n8n-nodes-base.microsoftOutlook",
      "typeVersion": 2,
      "position": [800, 450],
      "credentials": {
        "microsoftOutlookOAuth2Api": "outlook-credential"
      }
    },
    {
      "parameters": {
        "operation": "markAsRead",
        "messageId": "{{ $json.messageId }}"
      },
      "id": "mark-email-processed",
      "name": "Mark Email as Processed",
      "type": "n8n-nodes-base.microsoftOutlook",
      "typeVersion": 2,
      "position": [800, 600],
      "credentials": {
        "microsoftOutlookOAuth2Api": "outlook-credential"
      }
    },
    {
      "parameters": {},
      "id": "workflow-complete",
      "name": "Workflow Complete",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [1000, 350]
    }
  ],
  "connections": {
    "webhook-teams-trigger": {
      "main": [
        [
          {
            "node": "get-teams-messages",
            "type": "main",
            "index": 0
          },
          {
            "node": "get-outlook-emails",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get-teams-messages": {
      "main": [
        [
          {
            "node": "agent-cluster-email-manager",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get-outlook-emails": {
      "main": [
        [
          {
            "node": "get-email-history",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get-email-history": {
      "main": [
        [
          {
            "node": "agent-cluster-email-manager",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "agent-cluster-email-manager": {
      "main": [
        [
          {
            "node": "send-teams-response",
            "type": "main",
            "index": 0
          },
          {
            "node": "send-email-reply",
            "type": "main",
            "index": 0
          },
          {
            "node": "mark-email-processed",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "send-teams-response": {
      "main": [
        [
          {
            "node": "workflow-complete",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "send-email-reply": {
      "main": [
        [
          {
            "node": "workflow-complete",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "mark-email-processed": {
      "main": [
        [
          {
            "node": "workflow-complete",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "errorHandler": {
      "enabled": true,
      "description": "Handle workflow errors gracefully"
    }
  },
  "staticData": null,
  "pinData": null
}
